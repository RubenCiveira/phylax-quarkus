package net.civeira.phylax.features.access.trustedclient.domain.valueobject;

import java.util.Optional;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import net.civeira.phylax.common.crypto.AesCipherService;
import net.civeira.phylax.common.exception.ConstraintException;

class SecretOauthVOUnitTest {

  /**
   * @autogenerated ValueObjectGenerator
   */
  @Test
  @DisplayName("Test value object contruction for property secret oauth of trusted client ")
  void test_secret_oauth_v_o_builder() {
    Assertions.assertFalse(SecretOauthVO.nullValue().getSecretOauthCyphered(null).isPresent(),
        "A empty vo should have a null value");
    Assertions.assertFalse(SecretOauthVO.tryFrom(null).getSecretOauthCyphered(null).isPresent(),
        "With a null value, no present result");
    Assertions.assertEquals("null", SecretOauthVO.nullValue().toString());
    Assertions.assertThrows(ConstraintException.class,
        () -> SecretOauthVO.tryFrom(Integer.valueOf(1)));
    AesCipherService cypher = Mockito.mock(AesCipherService.class);
    Mockito.when(cypher.encryptForAll("one")).thenReturn("cyphered");
    Mockito.when(cypher.decryptForAll("one")).thenReturn(Optional.of("plain"));
    Mockito.when(cypher.decryptForAll("two")).thenReturn(Optional.empty());
    Assertions.assertEquals("one",
        SecretOauthVO.fromCyphered("one").getSecretOauthCyphered(null).orElse(null));
    Assertions.assertEquals("one",
        SecretOauthVO.fromPlain("one").getSecretOauthPlain(null).orElse(null));
    Assertions.assertEquals("plain",
        SecretOauthVO.fromCyphered("one").getSecretOauthPlain(cypher).orElse(null));
    Assertions.assertEquals("cyphered",
        SecretOauthVO.fromPlain("one").getSecretOauthCyphered(cypher).orElse(null));
    Assertions.assertThrows(IllegalStateException.class,
        () -> SecretOauthVO.fromCyphered("two").getSecretOauthPlain(cypher).orElse(null));
    Assertions.assertThrows(ConstraintException.class,
        () -> SecretOauthVO.tryFrom(new Object() {}));
    Assertions.assertEquals("[plain:*****]", SecretOauthVO.fromPlain("small").toString());
    Assertions.assertEquals("[plain:longt*****]",
        SecretOauthVO.fromPlain("longtextlongtext").toString());
    Assertions.assertEquals("[cyphered:" + "one" + "]",
        SecretOauthVO.fromCyphered("one").toString());
  }
}
