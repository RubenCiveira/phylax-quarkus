package net.civeira.phylax.features.access.useraccesstemporalcode.domain.valueobject;

import java.util.Optional;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import net.civeira.phylax.common.crypto.AesCipherService;
import net.civeira.phylax.common.exception.ConstraintException;

class TempSecondFactorSeedVOUnitTest {

  /**
   * @autogenerated ValueObjectGenerator
   */
  @Test
  @DisplayName("Test value object contruction for property temp second factor seed of user access temporal code ")
  void test_temp_second_factor_seed_v_o_builder() {
    Assertions.assertFalse(
        TempSecondFactorSeedVO.nullValue().getCypheredTempSecondFactorSeed(null).isPresent(),
        "A empty vo should have a null value");
    Assertions.assertFalse(
        TempSecondFactorSeedVO.tryFrom(null).getCypheredTempSecondFactorSeed(null).isPresent(),
        "With a null value, no present result");
    Assertions.assertEquals("null", TempSecondFactorSeedVO.nullValue().toString());
    AesCipherService cypher = Mockito.mock(AesCipherService.class);
    Mockito.when(cypher.encryptForAll("one")).thenReturn("cyphered");
    Mockito.when(cypher.decryptForAll("one")).thenReturn(Optional.of("plain"));
    Mockito.when(cypher.decryptForAll("two")).thenReturn(Optional.empty());
    Assertions.assertEquals("one", TempSecondFactorSeedVO.fromCyphered("one")
        .getCypheredTempSecondFactorSeed(null).orElse(null));
    Assertions.assertEquals("one",
        TempSecondFactorSeedVO.fromPlain("one").getPlainTempSecondFactorSeed(null).orElse(null));
    Assertions.assertEquals("plain", TempSecondFactorSeedVO.fromCyphered("one")
        .getPlainTempSecondFactorSeed(cypher).orElse(null));
    Assertions.assertEquals("cyphered", TempSecondFactorSeedVO.fromPlain("one")
        .getCypheredTempSecondFactorSeed(cypher).orElse(null));
    Assertions.assertThrows(IllegalStateException.class, () -> TempSecondFactorSeedVO
        .fromCyphered("two").getPlainTempSecondFactorSeed(cypher).orElse(null));
    Assertions.assertThrows(ConstraintException.class,
        () -> TempSecondFactorSeedVO.tryFrom(new Object() {}));
    Assertions.assertEquals("[plain:*****]", TempSecondFactorSeedVO.fromPlain("small").toString());
    Assertions.assertEquals("[plain:longt*****]",
        TempSecondFactorSeedVO.fromPlain("longtextlongtext").toString());
    Assertions.assertEquals("[cyphered:" + "one" + "]",
        TempSecondFactorSeedVO.fromCyphered("one").toString());
  }
}
