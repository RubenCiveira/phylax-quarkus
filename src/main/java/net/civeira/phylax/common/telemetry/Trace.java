/* @autogenerated */
package net.civeira.phylax.common.telemetry;

import java.util.Map;

import io.opentelemetry.api.common.Attributes;
import io.opentelemetry.api.common.AttributesBuilder;
import io.opentelemetry.api.trace.Span;

/**
 * Provides convenience methods for recording tracing events and attributes on the current
 * OpenTelemetry span.
 */
public final class Trace {
  private Trace() {
    /* private constructor to avoid build */
  }

  /**
   * Adds a simple event to the current span if a valid span is active.
   *
   * @param name event name to record
   */
  public static void addEvent(final String name) {
    Span span = Span.current();
    if (isValid(span) && name != null && !name.isBlank()) {
      span.addEvent(name);
    }
  }

  /**
   * Sets a boolean attribute on the current span if a valid span is active.
   *
   * @param key attribute key
   * @param value attribute value
   */
  public static void setAttribute(final String key, final boolean value) {
    Span span = Span.current();
    if (isValid(span) && key != null && !key.isBlank()) {
      span.setAttribute(key, value);
    }
  }

  /**
   * Sets a double attribute on the current span if a valid span is active.
   *
   * @param key attribute key
   * @param value attribute value
   */
  public static void setAttribute(final String key, final double value) {
    Span span = Span.current();
    if (isValid(span) && key != null && !key.isBlank()) {
      span.setAttribute(key, value);
    }
  }

  /**
   * Sets a long attribute on the current span if a valid span is active.
   *
   * @param key attribute key
   * @param value attribute value
   */
  public static void setAttribute(final String key, final long value) {
    Span span = Span.current();
    if (isValid(span) && key != null && !key.isBlank()) {
      span.setAttribute(key, value);
    }
  }

  /**
   * Sets a string attribute on the current span if a valid span is active.
   *
   * @param key attribute key
   * @param value attribute value
   */
  public static void setAttribute(final String key, final String value) {
    Span span = Span.current();
    if (isValid(span) && key != null && !key.isBlank() && value != null) {
      span.setAttribute(key, value);
    }
  }

  /**
   * Adds an event with string attributes to the current span.
   *
   * @param name event name to record
   * @param attributes key-value attributes to attach
   */
  public static void addEvent(final String name, final Map<String, String> attributes) {
    Span span = Span.current();
    if (!isValid(span) || name == null || name.isBlank()) {
      return;
    }
    if (attributes == null || attributes.isEmpty()) {
      span.addEvent(name);
      return;
    }
    AttributesBuilder builder = Attributes.builder();
    for (Map.Entry<String, String> entry : attributes.entrySet()) {
      if (entry.getKey() != null && entry.getValue() != null) {
        builder.put(entry.getKey(), entry.getValue());
      }
    }
    span.addEvent(name, builder.build());
  }

  private static boolean isValid(final Span span) {
    return span != null && span.getSpanContext().isValid();
  }
}
