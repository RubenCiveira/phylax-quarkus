/* @autogenerated */
package net.civeira.phylax.common.value.importation;

import java.text.Normalizer;
import java.util.Optional;
import java.util.Set;

import net.civeira.phylax.common.value.validation.AbstractFailList;
import net.civeira.phylax.common.value.validation.ConstraintFail;

public final class BooleanLoad {

  // Valores que aceptamos como "true"
  private static final Set<String> TRUE_VALUES = Set.of("true", // inglés
      "1", "yes", // inglés
      "y", "si", // español/italiano sin acento
      "sí", // español
      "ja", // alemán
      "oui", // francés
      "verdadero", "vero" // italiano
  );

  // Valores que aceptamos como "false"
  private static final Set<String> FALSE_VALUES = Set.of("false", // inglés
      "0", "no", // es/en/fr/it/de...
      "nein", // alemán
      "non", // francés/italiano
      "falso", "faux" // francés
  );

  public static <T extends AbstractFailList> Optional<Boolean> toBoolean(String field, String value,
      T fails) {
    if (value == null || value.isBlank()) {
      // mismo patrón que en los demás loaders
      fails.add(new ConstraintFail("NOT_NULL", field, null));
      return Optional.empty();
    }

    String normalized = normalize(value);

    if (TRUE_VALUES.contains(normalized)) {
      return Optional.of(Boolean.TRUE);
    }
    if (FALSE_VALUES.contains(normalized)) {
      return Optional.of(Boolean.FALSE);
    }

    // Si no encaja en nada conocido, registramos error
    fails.add(new ConstraintFail("INVALID_BOOLEAN", field, value));
    return Optional.empty();
  }

  private static String normalize(String raw) {
    // trim + minúsculas + quitar acentos
    String trimmed = raw.trim().toLowerCase();
    String normalized = Normalizer.normalize(trimmed, Normalizer.Form.NFD);
    return normalized.replaceAll("\\p{M}+", ""); // elimina diacríticos (ej: "sí" -> "si")
  }

  private BooleanLoad() {
    /* do nothing */
  }
}
