/* @autogenerated */
package net.civeira.phylax.common.value.validation.validators;

import java.util.regex.Pattern;

import net.civeira.phylax.common.value.validation.ValidationResult;
import net.civeira.phylax.common.value.validation.Validator;

/**
 * Validator for alphanumeric strings with configurable constraints. Allows control over length,
 * character types, and special characters.
 */
public class AlphanumericValidator implements Validator<String> {
  private final int minLength;
  private final int maxLength;
  private final boolean allowLowercase;
  private final boolean allowUppercase;
  private final boolean allowNumbers;
  private final boolean allowSpecialChars;
  private final String errorMessage;
  private final Pattern pattern;

  /**
   * Constructs an AlphanumericValidator with specified constraints.
   *
   * @param minLength Minimum allowed length of the string.
   * @param maxLength Maximum allowed length of the string.
   * @param allowLowercase Whether lowercase letters are allowed.
   * @param allowUppercase Whether uppercase letters are allowed.
   * @param allowNumbers Whether numeric digits are allowed.
   * @param allowSpecialChars Whether special characters are allowed.
   * @param errorMessage The error message to return when validation fails.
   * @throws IllegalArgumentException if minLength is negative or greater than maxLength.
   */
  public AlphanumericValidator(int minLength, int maxLength, boolean allowLowercase,
      boolean allowUppercase, boolean allowNumbers, boolean allowSpecialChars,
      String errorMessage) {
    if (minLength < 0 || maxLength < minLength) {
      throw new IllegalArgumentException("Invalid length parameters.");
    }
    this.minLength = minLength;
    this.maxLength = maxLength;
    this.allowLowercase = allowLowercase;
    this.allowUppercase = allowUppercase;
    this.allowNumbers = allowNumbers;
    this.allowSpecialChars = allowSpecialChars;
    this.errorMessage = errorMessage;
    this.pattern = Pattern.compile(buildRegex());
  }

  /**
   * Builds the regular expression pattern based on the configured constraints.
   *
   * @return The regex pattern as a string.
   * @throws IllegalArgumentException if no character types are selected.
   */
  private String buildRegex() {
    StringBuilder regex = new StringBuilder("^[");

    if (allowLowercase) {
      regex.append("a-z");
    }
    if (allowUppercase) {
      regex.append("A-Z");
    }
    if (allowNumbers) {
      regex.append("0-9");
    }
    if (allowSpecialChars) {
      regex.append("\\p{Punct}");
    }
    if (regex.length() == 2) {
      throw new IllegalArgumentException("Empty selector for alphanumeric");
    }
    regex.append("]{").append(minLength).append(",").append(maxLength).append("}$");
    return regex.toString();
  }

  /**
   * Validates the input string against the configured constraints.
   *
   * @param input The input string to validate.
   * @return A ValidationResult indicating success or failure.
   */
  @Override
  public ValidationResult validate(String input) {
    if (input == null || !pattern.matcher(input).matches()) {
      return new ValidationResult(errorMessage);
    }
    return new ValidationResult();
  }
}
