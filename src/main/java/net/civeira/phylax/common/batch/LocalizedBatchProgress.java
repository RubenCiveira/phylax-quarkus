/* @autogenerated */
package net.civeira.phylax.common.batch;

import java.time.Instant;
import java.util.List;
import java.util.Locale;

import io.quarkus.runtime.annotations.RegisterForReflection;
import lombok.Builder;
import lombok.Data;
import net.civeira.phylax.common.batch.BatchProgress.GlobalStatus;

/**
 * Localized view of {@link BatchProgress} for user-facing APIs and UIs.
 *
 * It mirrors the batch progress structure while translating step-level results. The locale
 * determines how error messages and labels are rendered. This is useful when exposing batch status
 * to clients in multiple languages. The class is immutable and supports native reflection for
 * serialization.
 */
@Data
@Builder
@RegisterForReflection
public class LocalizedBatchProgress {
  /** Unique identifier of the batch process. */
  private final String uid;
  /** Global execution status of the batch process. */
  private final GlobalStatus status;
  /** Timestamp indicating when the batch process started. */
  private final Instant startTime;
  /**
   * Timestamp indicating when the batch process finished. Can be {@code null} if the batch is still
   * running or pending.
   */
  private final Instant endTime;
  /** Localized progress information for each individual step in the batch. */
  private final List<LocalizedBatchStepProgress> steps;

  /**
   * Converts a {@link BatchProgress} to a localized view using the specified locale.
   *
   * This maps each step through {@link LocalizedBatchStepProgress#from}. Timestamps and status are
   * preserved while errors are localized. Use this when returning progress to a localized UI or API
   * client.
   *
   * @param progress original batch progress
   * @param locale target locale for localization
   * @return localized representation of the batch progress
   */
  public static LocalizedBatchProgress from(BatchProgress progress, Locale locale) {
    return LocalizedBatchProgress.builder().uid(progress.getUid()).status(progress.getStatus())
        .startTime(progress.getStartTime()).endTime(progress.getEndTime()).steps(progress.getSteps()
            .stream().map(step -> LocalizedBatchStepProgress.from(step, locale)).toList())
        .build();
  }
}
