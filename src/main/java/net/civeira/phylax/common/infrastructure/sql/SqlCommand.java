/* @autogenerated */
package net.civeira.phylax.common.infrastructure.sql;

import lombok.extern.slf4j.Slf4j;

/**
 * Represents an executable SQL command (e.g., INSERT, UPDATE, DELETE).
 *
 * The command supports named parameter binding and executes via {@link SqlTemplate}. It is intended
 * for statements that do not return a result set. The class is final to keep behavior consistent
 * and predictable. Execution delegates to the base class which handles tracing and errors.
 */
@Slf4j
public final class SqlCommand extends AbstractSqlCommand<SqlCommand> {
  /**
   * The raw SQL statement to be executed.
   */
  private final String sql;


  /**
   * Constructs a new {@code SqlCommand} using the given SQL template and statement.
   *
   * The raw SQL is stored and later executed with parameter binding. Use
   * {@link SqlTemplate#createSqlCommand(String)} to create commands. The template manages
   * connection and optional tracing.
   *
   * @param template the SQL template engine used to prepare the final query
   * @param sql the SQL statement as a raw string
   */
  /* default */ SqlCommand(SqlTemplate template, String sql) {
    super(template);
    this.sql = sql;
  }

  /**
   * Binds a named parameter to this command.
   *
   * The parameter name must match a placeholder in the SQL statement. The value object handles
   * binding to the prepared statement. This method returns the command for fluent chaining.
   *
   * @param name the parameter name
   * @param consumer the parameter value object
   * @return this {@code SqlCommand} instance for fluent usage
   */
  @Override
  public SqlCommand with(String name, SqlParameterValue consumer) {
    super.with(name, consumer);
    return this;
  }

  /**
   * Executes the SQL command (e.g., INSERT, UPDATE, DELETE).
   *
   * The execution binds parameters and runs the statement through the template. The return value
   * typically represents the number of affected rows. Errors are wrapped as
   * {@link UncheckedSqlException} by the base class.
   *
   * @return the number of affected rows
   */
  @Override
  public Integer execute() {
    log.info("Execute: " + this.sql);
    return executeUpdate(this.sql);
  }
}
