package net.civeira.phylax.features.access.tenantconfig.infrastructure.bootstrap;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.function.UnaryOperator;

import jakarta.enterprise.context.ApplicationScoped;
import net.civeira.phylax.common.infrastructure.projection.ExecutionAggregation;
import net.civeira.phylax.common.infrastructure.projection.ExecutionNode;
import net.civeira.phylax.common.infrastructure.projection.ParamKind;
import net.civeira.phylax.common.infrastructure.projection.ProjectionDescriptor;
import net.civeira.phylax.common.infrastructure.projection.RelationshipDefinition;
import net.civeira.phylax.features.access.tenant.infrastructure.bootstrap.TenantProjectionDescriptor.TenantExecutionPlanner;

@ApplicationScoped
public class TenantConfigProjectionDescriptor implements ProjectionDescriptor {

  /**
   * @autogenerated ProjectionDescriptorGeneratorGenerator
   */
  public static class TenantConfigExecutionPlanner {

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     */
    private final List<ExecutionAggregation> aggregation = new ArrayList<>();

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     */
    String prefix;

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     */
    public TenantConfigExecutionPlanner() {
      this.prefix = "";
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param prefix
     */
    public TenantConfigExecutionPlanner(final String prefix) {
      this.prefix = prefix + ".";
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public List<ExecutionAggregation> build() {
      return aggregation;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withAllowRecoverPass() {
      return withAllowRecoverPass(prefix + "allowRecoverPass");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withAllowRecoverPass(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("allowRecoverPass").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withAllowRegister() {
      return withAllowRegister(prefix + "allowRegister");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withAllowRegister(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("allowRegister").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withDisabledUserEmail() {
      return withDisabledUserEmail(prefix + "disabledUserEmail");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withDisabledUserEmail(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("disabledUserEmail").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withEnableRegisterUsers() {
      return withEnableRegisterUsers(prefix + "enableRegisterUsers");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withEnableRegisterUsers(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("enableRegisterUsers").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withEnabledUserEmail() {
      return withEnabledUserEmail(prefix + "enabledUserEmail");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withEnabledUserEmail(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("enabledUserEmail").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withForceMfa() {
      return withForceMfa(prefix + "forceMfa");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withForceMfa(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("forceMfa").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withInnerLabel() {
      return withInnerLabel(prefix + "innerLabel");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withInnerLabel(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("innerLabel").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withRecoverPassEmail() {
      return withRecoverPassEmail(prefix + "recoverPassEmail");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withRecoverPassEmail(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("recoverPassEmail").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withRegisterdEmail() {
      return withRegisterdEmail(prefix + "registerdEmail");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withRegisterdEmail(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("registerdEmail").alias(alias)
          .selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withTenant() {
      return withTenant(prefix + "tenant", null);
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withTenant(final String alias) {
      return withTenant(alias, null);
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param callback
     * @return
     */
    public TenantConfigExecutionPlanner withTenant(
        final UnaryOperator<TenantExecutionPlanner> callback) {
      return withTenant(prefix + "tenant", callback);
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @param callback
     * @return
     */
    public TenantConfigExecutionPlanner withTenant(final String alias,
        final UnaryOperator<TenantExecutionPlanner> callback) {
      aggregation
          .add(ExecutionAggregation.builder().name("tenant").alias(alias)
              .selection(null != callback
                  ? callback.apply(new TenantExecutionPlanner(prefix + alias)).build()
                  : List.of())
              .build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withUid() {
      return withUid(prefix + "uid");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withUid(final String alias) {
      aggregation.add(
          ExecutionAggregation.builder().name("uid").alias(alias).selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withVersion() {
      return withVersion(prefix + "version");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withVersion(final String alias) {
      aggregation.add(
          ExecutionAggregation.builder().name("version").alias(alias).selection(List.of()).build());
      return this;
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @return
     */
    public TenantConfigExecutionPlanner withWellcomeEmail() {
      return withWellcomeEmail(prefix + "wellcomeEmail");
    }

    /**
     * @autogenerated ProjectionDescriptorGeneratorGenerator
     * @param alias
     * @return
     */
    public TenantConfigExecutionPlanner withWellcomeEmail(final String alias) {
      aggregation.add(ExecutionAggregation.builder().name("wellcomeEmail").alias(alias)
          .selection(List.of()).build());
      return this;
    }
  }

  /**
   * @autogenerated ProjectionDescriptorGeneratorGenerator
   * @param baseServer
   * @return
   */
  @Override
  public List<ExecutionNode> baseNodes(final String baseServer) {
    Map<String, RelationshipDefinition> relations = relations(baseServer);
    return List.of(
        ExecutionNode.builder().server(baseServer).endpoint("/api/access/tenants-config")
            .method("GET").list(true).params(Map.of()).relations(relations).build(),
        ExecutionNode.builder().server(baseServer).endpoint("/api/access/tenants-config/{uid}")
            .method("GET").list(false).params(Map.of("uid", ParamKind.PATH)).relations(relations)
            .build());
  }

  /**
   * @autogenerated ProjectionDescriptorGeneratorGenerator
   * @param baseServer
   * @return
   */
  private Map<String, RelationshipDefinition> relations(final String baseServer) {
    return Map.of("tenant",
        RelationshipDefinition.builder().list(false).id("/api/access/tenants")
            .url(baseServer + "/api/access/tenants").method("GET").batchParam("uids").on("$ref")
            .referenceField("uid").build());
  }
}
