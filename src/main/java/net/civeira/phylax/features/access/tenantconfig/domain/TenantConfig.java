package net.civeira.phylax.features.access.tenantconfig.domain;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import lombok.AccessLevel;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.NonNull;
import lombok.ToString;
import lombok.With;
import lombok.experimental.Delegate;
import net.civeira.phylax.common.exception.ConstraintException;
import net.civeira.phylax.common.value.validation.ConstraintFailList;
import net.civeira.phylax.features.access.tenantconfig.domain.event.TenantConfigCreateEvent;
import net.civeira.phylax.features.access.tenantconfig.domain.event.TenantConfigDeleteEvent;
import net.civeira.phylax.features.access.tenantconfig.domain.event.TenantConfigEvent;
import net.civeira.phylax.features.access.tenantconfig.domain.event.TenantConfigUpdateEvent;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.AllowRecoverPassVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.AllowRegisterVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.DisabledUserEmailVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.EnableRegisterUsersVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.EnabledUserEmailVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.ForceMfaVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.InnerLabelVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.RecoverPassEmailVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.RegisterdEmailVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.TenantVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.UidVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.VersionVO;
import net.civeira.phylax.features.access.tenantconfig.domain.valueobject.WellcomeEmailVO;

/**
 * tenant-config
 */
@Builder
@Getter
@With
@ToString
@AllArgsConstructor(access = AccessLevel.PRIVATE)
@EqualsAndHashCode
public class TenantConfig implements TenantConfigRef {

  /**
   * Prepare a new tenant config with the provided values
   *
   * @autogenerated EntityGenerator
   * @param change A set of values to create a new tenant config
   * @throws ConstraintException If there are some constraints fails on the changes.
   * @return A well formed tenant config.
   */
  public static TenantConfig create(final TenantConfigChangeSet change) throws ConstraintException {
    TenantConfig instance = new TenantConfig(change, Optional.empty());
    instance.addEvent(TenantConfigCreateEvent.builder().payload(instance).build());
    return instance;
  }

  /**
   * El allow recover pass de tenant config
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private AllowRecoverPassVO allowRecoverPassValue = AllowRecoverPassVO.nullValue();

  /**
   * El allow register de tenant config
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private AllowRegisterVO allowRegisterValue = AllowRegisterVO.nullValue();

  /**
   * Email send when a user is disabled
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private DisabledUserEmailVO disabledUserEmailValue = DisabledUserEmailVO.nullValue();

  /**
   * El enable register users de tenant config
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private EnableRegisterUsersVO enableRegisterUsersValue = EnableRegisterUsersVO.nullValue();

  /**
   * Email send when a user is enabled
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private EnabledUserEmailVO enabledUserEmailValue = EnabledUserEmailVO.nullValue();

  /**
   * El force mfa de tenant config
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @NonNull
  private ForceMfaVO forceMfaValue;

  /**
   * Tenant could use these field to label the application for the users
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private InnerLabelVO innerLabelValue = InnerLabelVO.nullValue();

  /**
   * List of events
   *
   * @autogenerated EntityGenerator
   */
  @Builder.Default
  private List<TenantConfigEvent> recordedEvents = List.of();

  /**
   * Email send to the user to recover the password
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private RecoverPassEmailVO recoverPassEmailValue = RecoverPassEmailVO.nullValue();

  /**
   * El registerd email de tenant config
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private RegisterdEmailVO registerdEmailValue = RegisterdEmailVO.nullValue();

  /**
   * The name to identify the account.
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @NonNull
  private TenantVO tenantValue;

  /**
   * A number to identify the db record
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @NonNull
  private UidVO uidValue;

  /**
   * Campo con el n√∫mero de version de tenant config para controlar bloqueos optimistas
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private VersionVO versionValue = VersionVO.nullValue();

  /**
   * Email send to the enabled user
   *
   * @autogenerated EntityGenerator
   */
  @Delegate
  @Builder.Default
  private WellcomeEmailVO wellcomeEmailValue = WellcomeEmailVO.nullValue();

  /**
   * @autogenerated EntityGenerator
   * @param attribute
   * @param previous
   */
  private TenantConfig(final TenantConfigChangeSet attribute,
      final Optional<TenantConfig> previous) {
    ConstraintFailList list = new ConstraintFailList();
    this.uidValue = attribute.readUid(previous, list);
    this.tenantValue = attribute.readTenant(previous, list);
    this.innerLabelValue = attribute.readInnerLabel(previous, list);
    this.forceMfaValue = attribute.readForceMfa(previous, list);
    this.allowRegisterValue = attribute.readAllowRegister(previous, list);
    this.enableRegisterUsersValue = attribute.readEnableRegisterUsers(previous, list);
    this.wellcomeEmailValue = attribute.readWellcomeEmail(previous, list);
    this.registerdEmailValue = attribute.readRegisterdEmail(previous, list);
    this.disabledUserEmailValue = attribute.readDisabledUserEmail(previous, list);
    this.enabledUserEmailValue = attribute.readEnabledUserEmail(previous, list);
    this.allowRecoverPassValue = attribute.readAllowRecoverPass(previous, list);
    this.recoverPassEmailValue = attribute.readRecoverPassEmail(previous, list);
    this.versionValue = attribute.readVersion(previous, list);
    if (list.hasErrors()) {
      throw new ConstraintException("Invalid values on TenantConfig", list);
    }
    this.recordedEvents = previous.map(TenantConfig::getRecordedEvents).orElseGet(List::of);
  }

  /**
   * Apply changes to delete a tenant config
   *
   * @autogenerated EntityGenerator
   * @return A instance of tenant config ready to be deleted
   */
  public TenantConfig delete() {
    TenantConfig instance = new TenantConfig(new TenantConfigChangeSet(), Optional.of(this));
    instance.addEvent(TenantConfigDeleteEvent.builder().payload(instance).build());
    return instance;
  }

  /**
   * Modify the values for some of the properties of a tenant config
   *
   * @autogenerated EntityGenerator
   * @param change The properties to be modified
   * @throws ConstraintException If there are some constraints fails on the changes.
   * @return A modified instance of tenant config
   */
  public TenantConfig update(final TenantConfigChangeSet change) throws ConstraintException {
    TenantConfig instance = new TenantConfig(change, Optional.of(this));
    instance.addEvent(TenantConfigUpdateEvent.builder().payload(instance).build());
    return instance;
  }

  /**
   * @autogenerated EntityGenerator
   * @return
   */
  public TenantConfig withNextVersion() {
    return withVersionValue(VersionVO.from(nextVersion()));
  }

  /**
   * @autogenerated EntityGenerator
   * @param event
   */
  private void addEvent(final TenantConfigEvent event) {
    List<TenantConfigEvent> events = new ArrayList<>(this.recordedEvents);
    events.add(event);
    this.recordedEvents = List.copyOf(events);
  }
}
