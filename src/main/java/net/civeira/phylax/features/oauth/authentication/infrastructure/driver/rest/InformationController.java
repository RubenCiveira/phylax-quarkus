/* @autogenerated */
package net.civeira.phylax.features.oauth.authentication.infrastructure.driver.rest;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.eclipse.microprofile.jwt.JsonWebToken;

import io.quarkus.runtime.annotations.RegisterForReflection;
import jakarta.enterprise.context.RequestScoped;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.core.Response;
import lombok.Data;
import lombok.RequiredArgsConstructor;

/**
 * Controlador REST para consultar el usario conectado a un servidor de recursos
 */
@RequestScoped
@RequiredArgsConstructor
@Path("")
public class InformationController {

  @Data
  @RegisterForReflection
  public static class Info {
    private String sub;
    private String name;
    private List<String> roles = new ArrayList<>();
  }

  private final JsonWebToken jwt;

  /**
   * Recupera los datos de un usuario conectado.
   * 
   * @param request la peticion http sobre la que se hace la petici√≥n
   * @return los datos del usuario conecatdo
   */
  @GET
  @Path("oauth/openid/{tenant}/userinfo")
  public Response retrieveUserData(String tenant) {
    Map<String, String> map = new HashMap<>();
    map.putAll(
        Map.of("sub", jwt.getSubject(), "name", jwt.getSubject(), "issuer", jwt.getIssuer()));
    return Response.ok(map).build();
  }
}
